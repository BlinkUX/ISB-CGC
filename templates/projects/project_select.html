{% extends 'base.html' %}
{% load staticfiles %}
{% load custom_tags %}
{% block title %}Projects | ISB-CGC{% endblock %}}
{% block extra_css_libs %}{% endblock %}
{% block header %}{% endblock %}

{% block link_page_name %}project_list{% endblock %}
{% block page_name %}project_list{% endblock %}

{% block page_header %}
<div class="container">
    <h1 class="page-header pull-left">Import From Basespace</h1>
</div>
{% endblock %}
{% block content %}
<div class="container">
    <section class="panel panel-primary" style="padding:10px">
        <p>Importing files from <label>{{ bs_project.name }}</label></p>
        <input type="hidden" id="bs-project-name" value="{{ bs_project.name }}">
        <input type="hidden" id="bs-project-description" value="{{ bs_project.description }}">
        <input type="hidden" id="access-token" value="{{ access_token }}">
        <input type="hidden" id="session-uri" value="{{ session_uri }}">
        <input type="hidden" id="action-url" value="{% url 'file_import' %}">
        <div class="padding-10" style="padding : 10px">
            {% if files %}
                <table id="file-table" class="table tablesorter">
                    <thead>
                        <th class="name-col">File Name</th>
                        <th class="study-col">Size</th>
                    </thead>
                    <tbody>
                        {% for file in files %}
                            <tr class="file" name="{{ file.name }}" size="{{ file.rawsize }}" href="{{ file.href }}" class="row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
                                <td class="name-col">{{ file.name }}</td>
                                <td class="study-col">{{ file.size }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="center space-top-10">No files were selected within Basespace</p>
            {% endif %}
        </div>
    </section>

    <div class="panel">
        <div class="panel-heading">
            <label>Select project to import files</label>
        </div>
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active">
                <a href="#existing-projects-list" aria-controls="existing-projects-list" role="tab" data-toggle="tab">Existing Project</a>
            </li>
            <li role="presentation">
                <a href="#new-project" aria-controls="new-projects-list" role="tab" data-toggle="tab">New Project</a>
            </li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="existing-projects-list">
                <div class="panel-body">
                    {% if projects %}
                        <table class="table tablesorter">
                            <thead>
                                <th class="control-col"></th>
                                <th class="name-col">Name</th>
                                <th class="study-col">Studies</th>
                                <th>Shared with</th>
                                <th>Last Updated</th>
                            </thead>
                            <tbody>
                                {% for project in projects %}
                                <tr class="row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
                                    <td class="control-col">
                                        <input type="radio" name="project-selection" {% if forloop.counter == 1%} checked {% endif %} value="{{project.id}}">
                                    </td>
                                    <td class="name-col">{{ project.name }}</td>
                                    <td>{{ project.study_set.all|active|length }}</td>
                                    <td>({{ project.shared.count }})</td>
                                    <td>{{ project.last_date_saved|date:"SHORT_DATETIME_FORMAT" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div style="height:35px">
                            <button id="upload-button" class="btn btn-primary pull-right"><i class="fa fa-cloud-upload"></i>Import Files</button>
                        </div>
                    {% else %}
                        <p class="center space-top-10">You don't have any saved projects yet</p>
                        <p class="center"><a href="{% url 'project_upload' %}" class="btn btn-default"><i class="fa fa-cloud-upload"></i>Upload Project Data</a></p>
                    {% endif %}
                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="new-project">
                <input type="hidden" id="project-tab" value="new">
                <div class="panel-body">
                    <section id="project-info" class="collapse in">
                        <div class="form-group">
                            <label for="project-name">Project Name</label>
                            <input class="form-control" type="text" name="project-name" id="project-name">
                        </div>
                        <div class="form-group">
                            <label for="project-description">Project Description (Optional)</label>
                            <textarea class="form-control" name="project-description" id="project-description" cols="30" rows="5"></textarea>
                        </div>
                    </section>
                    <div style="height:35px">
                        <button id="upload-button-new" class="btn btn-primary pull-right"><i class="fa fa-cloud-upload"></i>Import Files</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js_file %}{% static 'js/project_import.js' %}{% endblock %}